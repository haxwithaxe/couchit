if(!document.createElementNS){document.createElement("section");document.createElement("audio");document.createElement("video");document.createElement("article");document.createElement("aside");document.createElement("footer");document.createElement("header");document.createElement("nav");document.createElement("time")}Date.parseRFC3339=function(C){var B=new Date(0);var A=C.match(/(\d{4})-(\d\d)-(\d\d)\s*(?:[\sT]\s*(\d\d):(\d\d)(?::(\d\d))?(\.\d*)?\s*(Z|([-+])(\d\d):(\d\d))?)?/);if(!A){return }if(A[2]){A[2]--}if(A[7]){A[7]=(A[7]+"000").substring(1,4)}var E=[null,"FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"];for(var D=1;D<=7;D++){if(A[D]){B["setUTC"+E[D]](A[D])}}if(A[9]){B.setTime(B.getTime()+(A[9]=="-"?1:-1)*(A[10]*3600000+A[11]*60000))}return B.getTime()};function localizeDates(){var B="";var A=new Date();$$("time").each(function(E,D){if(E.getAttribute("title")=="GMT"){var C=new Date(Date.parseRFC3339(E.getAttribute("datetime")));if(!C.getTime()){return }diff=((A.getTime()-C.getTime())/1000),day_diff=Math.floor(diff/86400);if(isNaN(day_diff)||day_diff<0||day_diff>=31){return }var G=C.toLocaleString();var F=C.toLocaleString();if(day_diff==0){G=(diff<60&&"Just Now"||diff<120&&"1 minute ago"||diff<3600&&Math.floor(diff/60)+" minutes ago"||diff<7200&&"1 hour ago"||diff<86400&&Math.floor(diff/3600)+" hours ago");F=C.toLocaleTimeString()}else{G=(day_diff=1&&"Yesterday"||day_diff<7&&day_diff+" days ago");F=C.toLocaleString()}E.setAttribute("title",F);E.textContent="posted "+G}})}var Page={};var Site={url:"",name:""};var FORBIDDEN_PAGES=["site","delete","edit","create","history","changes"];var Create=Class.create({initialize:function(){var A=this;this.Form=$("fnewpage");this.doCreate=$("doCreate");this.Form.addClassName("hidden");Event.observe(this.doCreate,"click",function(B){Event.stop(B);A.show();return false},false);Event.observe($$("a.cancelCreate")[0],"click",function(B){Event.stop(B);A.cancel();return false},false);$("screate").observe("click",function(B){Event.stop(B);A.submit();return false},false)},show:function(){this.doCreate.addClassName("hidden");this.Form.removeClassName("hidden")},cancel:function(){this.Form.addClassName("hidden");this.doCreate.removeClassName("hidden")},submit:function(){var B=$("title");if(!B.value.match(/^[ \w\u00A1-\uFFFF]+$/i)||FORBIDDEN_PAGES.indexOf(B.value)>=0){alert("Page title invalid");return false}var A=B.value.replace(/ /g,"_");document.location.href=Site.url+"/"+A+"#pedit"},});var Compare=Class.create({nb_selected:0,selected:false,initialize:function(){var A=this;this.Form=$("fhistory");$$("input.c").each(function(B){B.observe("click",function(C){A.check(this)},false)})},check:function(A){row=A.parentNode.parentNode;row.toggleClassName("rselected");if(!A.checked){this.nb_selected-=1;A.removeClassName("selected")}else{this.nb_selected+=1;A.addClassName("selected")}if(this.nb_selected==2){$$("input.c").each(function(B){if(!B.hasClassName("selected")){B.disabled="disabled"}});this.selected=true}else{if(this.selected){$$("input.c").each(function(B){if(!B.hasClassName("selected")){B.disabled=null}});this.selected=false}}}});var Diff=Class.create({initialize:function(){var A=this;this.rev_from=$("rev_from");this.rev_to=$("rev_to");$("scompare").observe("click",function(B){Event.stop(B);A.get_diff();return false})},get_diff:function(){var B=this.rev_from.getValue();var A=this.rev_to.getValue();if(B==A){alert("Why would you want compare same version ...");return }url=$("fdiff").action+"?r="+B+"&r="+A;new Ajax.Request(url,{method:"get",contentType:"application/json",requestHeaders:{Accept:"application/json"},onSuccess:function(C){data=C.responseText.evalJSON(true);if(data.ok){Element.remove($("tableDiff"));$("pdiff").insert(data.diff)}}})}});document.observe("dom:loaded",function(){localizeDates()});var PageUI=Class.create({initialize:function(){var A=this;this.Sidebar=$("sidebar");this.Page=$("page");this.tabs=new Control.Tabs("tabs_wiki");this.textarea=new Control.TextArea("content");this.toolbar=new Control.TextArea.ToolBar(this.textarea);this.toolbar.container.id="markdown_toolbar";this.converter=new Showdown.converter;this.converter_callback=function(B){$("preview").update(A.converter.makeHtml(B))};this.converter_callback(this.textarea.getValue());this.textarea.observe("change",A.converter_callback);this.snippet_window=new Control.Window($("snippet_window"),{resizable:true,draggable:$("snippet_window_title"),closeOnClick:$("snippet_window_close")});this.build_toolbar();this.init();this.tabs.observe("beforeChange",function(C,B){if(!Page.created){A.update_tabs(B)}else{var D=window.confirm("Are you sure you want to navigate away from this page?\n\nYou have unsaved changes. Continue and discard those changes?\n\nClick OK to continue, or click Cancel to stay on this page.");if(!D){throw $break}else{history.go(-1)}}});Event.observe(window,"resize",function(C){var B=document.viewport.getHeight()-150;$("content").setStyle({height:B+"px"})});$("cancelEdit").observe("click",function(B){Event.stop(B);A.tabs.setActiveTab("pview");return false})},init:function(){var B=this.tabs.activeContainer;if(B){this.update_tabs(B)}var A=document.viewport.getHeight()-150;$("content").setStyle({height:A+"px"})},update_tabs:function(A){if(A.id=="pedit"){this.Sidebar.hide();this.Page.setStyle({width:"99%"})}else{this.Page.setStyle({width:"76%"});this.Sidebar.show()}},build_toolbar:function(){var A=this;this.toolbar.addButton("Italics",function(){this.wrapSelection("*","*")},{id:"markdown_italics_button"});this.toolbar.addButton("Bold",function(){this.wrapSelection("**","**")},{id:"markdown_bold_button"});this.toolbar.addButton("Link",function(){var C=this.getSelection();var B=prompt("Enter Link URL","");if(B==null){return }this.replaceSelection("["+(C==""?"Link Text":C)+"]("+(B==""?"http://link_url/":B).replace(/^(?!(f|ht)tps?:\/\/)/,"http://")+")")},{id:"markdown_link_button"});this.toolbar.addButton("Image",function(){var C=this.getSelection();var B=prompt("Enter Image URL","");if(B==null){return }this.replaceSelection("!["+(C==""?"Image Alt Text":C)+"]("+(B==""?"http://image_url/":B).replace(/^(?!(f|ht)tps?:\/\/)/,"http://")+")")},{id:"markdown_image_button"});this.toolbar.addButton("Heading",function(){var B=this.getSelection();if(B==""){B="Heading"}this.replaceSelection("\n"+B+"\n"+$R(0,Math.max(5,B.length)).collect(function(){}).join("")+"\n")},{id:"markdown_heading_button"});this.toolbar.addButton("Unordered List",function(B){this.collectFromEachSelectedLine(function(C){return B.shiftKey?(C.match(/^\*{2,}/)?C.replace(/^\*/,""):C.replace(/^\*\s/,"")):(C.match(/\*+\s/)?"*":"* ")+C})},{id:"markdown_unordered_list_button"});this.toolbar.addButton("Ordered List",function(C){var B=0;this.collectFromEachSelectedLine(function(D){if(!D.match(/^\s+$/)){++B;return C.shiftKey?D.replace(/^\d+\.\s/,""):(D.match(/\d+\.\s/)?"":B+". ")+D}})},{id:"markdown_ordered_list_button"});this.toolbar.addButton("Block Quote",function(B){this.collectFromEachSelectedLine(function(C){return B.shiftKey?C.replace(/^\> /,""):"> "+C})},{id:"markdown_quote_button"});this.toolbar.addButton("Code Block",function(B){this.collectFromEachSelectedLine(function(C){return B.shiftKey?C.replace(/    /,""):"    "+C})},{id:"markdown_code_button"});this.toolbar.addButton("Snippet",function(E){var C=this.getSelection();if(C){var B=C.split("\n");if(B[0].match(/\s*:::(\w*)/)){var H=B[0].replace(/\s*:::(\w*)/,"$1");B.splice(0,1);if(H){$("snippet_language").select("option").each(function(I){if(I.value==H){I.selected=true}})}}var D=$A(B).collect(function(I){return I.replace(/    /,"")}).join("\n");$("snippet_content").value=D}A.snippet_window.open();var F=this;var G=function(L){Event.stop(L);var K=$("fsnippet").getInputs("radio","snippet_from");if(K[0].checked){var J=$("snippet_content").getValue();J=$A(J.split("\n")).collect(function(M){M="    "+M;return M}).join("\n");D="\n\n    :::"+$("snippet_language").getValue()+"\n"+J;F.insertAfterSelection(D);A.snippet_window.close();$("snippet_content").value=""}else{var I="/proxy?url="+encodeURIComponent($("snippet_url").getValue());new Ajax.Request(I,{method:"get",contentType:"application/json",requestHeaders:{Accept:"application/json"},onSuccess:function(M){data=M.responseText.evalJSON(true);J=$A(data.snippet.split("\n")).collect(function(N){return"    "+N}).join("\n");D=" \n\n    :::"+data.language+"\n"+J;F.insertAfterSelection(D);A.snippet_window.close();$("snippet_content").value=""},onFailure:function(){alert("fuck")}})}return false};$("ssnippet").observe("click",G,false);$("cancelSnippet").observe("click",function(I){Event.stop(I);A.snippet_window.close();return false})},{id:"markdown_snippet_button"});this.toolbar.addButton("Help",function(){window.open("http://daringfireball.net/projects/markdown/dingus")},{id:"markdown_help_button"})}});